<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Validate Certificates</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Inter, Arial;
  background:#f4f7fb;
}

.container {
  max-width:1000px;
  margin:40px auto;
}

.card {
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 28px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

img.cert {
  max-width:200px;
  border-radius:8px;
  margin-top:10px;
  cursor:pointer;
}

button {
  padding:8px 14px;
  border-radius:8px;
  border:none;
  font-weight:600;
  cursor:pointer;
}

.approve { background:#16a34a; color:white; }
.reject { background:#dc2626; color:white; margin-left:10px; }

/* ===== MODAL STYLES ===== */
.modal {
  display:none;
  position:fixed;
  z-index:9999;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
}

.modal-content {
  display:block;
  margin:auto;
  max-width:90%;
  max-height:90%;
  margin-top:60px;
  border-radius:12px;
}

.close {
  position:absolute;
  top:20px;
  right:35px;
  font-size:40px;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">
  <h2>Pending Certificate Validations</h2>
  <div id="list">Loading...</div>
</div>

<!-- ===== IMAGE MODAL ===== -->
<div id="imageModal" class="modal" onclick="closeModal()">
  <span class="close">&times;</span>
  <img id="modalImg" class="modal-content">
</div>

<script>
async function loadPending() {
  const res = await fetch('/api/mentor/certificates/pending', { credentials:'include' });
  const list = document.getElementById("list");

  if (!res.ok) {
    list.innerHTML = "Unauthorized";
    return;
  }

  const certs = await res.json();

  if (certs.length === 0) {
    list.innerHTML = "No pending certificates";
    return;
  }

  list.innerHTML = certs.map(c => `
    <div class="card">
      <b>Student USN:</b> ${c.studentUsn}<br>
      <b>Type:</b> ${c.certificateType}<br>
      <b>Points:</b> ${c.activityPoints}<br>

      <img class="cert"
           src="/${c.filePath}"
           onclick="openModal('/${c.filePath}')">

      <br><br>
      <button class="approve" onclick="approve(${c.certificateId})">Approve</button>
      <button class="reject" onclick="reject(${c.certificateId})">Reject</button>
    </div>
  `).join("");
}

function openModal(src) {
  const modal = document.getElementById("imageModal");
  const img = document.getElementById("modalImg");
  img.src = src;
  modal.style.display = "block";
}

function closeModal() {
  document.getElementById("imageModal").style.display = "none";
}

async function approve(id) {
  await fetch(`/api/mentor/certificate/${id}/approve`, {
    method: "POST",
    credentials:"include"
  });
  loadPending();
}

async function reject(id) {
  await fetch(`/api/mentor/certificate/${id}/reject`, {
    method: "POST",
    credentials:"include"
  });
  loadPending();
}

loadPending();
</script>

</body>
</html>
